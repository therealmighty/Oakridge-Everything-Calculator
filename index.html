<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Oakridge Systems | Demand · Paycheck · Efficiency</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* Parallax background */
    :root {
      --accent: #c7ff1f;
      --accent-dark: #a8ff00;
      --panel-bg: rgba(0,0,0,0.82);
    }

    html,body { height: 100%; margin: 0; }
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: url("https://i.ibb.co/N2Jq1f9Z/image.png") center/cover fixed no-repeat;
      color: #ddd;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 36px 20px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .container {
      width: 100%;
      max-width: 920px;
      background: var(--panel-bg);
      border-radius: 14px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.7);
      border: 1px solid rgba(255,255,255,0.03);
      padding: 26px;
      backdrop-filter: blur(6px) saturate(120%);
      position: relative;
      z-index: 2;
    }

    h1 { margin: 0 0 12px 0; color: var(--accent); text-align: center; }
    h2 { color: var(--accent); margin: 14px 0 8px; text-align: left; font-size: 1.15rem; }

    /* form elements */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .full { grid-column: 1 / -1; }

    label {
      display:block;
      font-size: 0.95rem;
      color: #ddd;
      margin-bottom: 6px;
    }

    input[type="number"] {
      width:100%;
      padding: 10px 12px;
      border-radius: 8px;
      background: #181818;
      border: 1px solid #333;
      color: #eee;
      font-size: 14px;
      box-sizing: border-box;
    }

    button {
      display:inline-block;
      padding: 10px 14px;
      border-radius: 8px;
      background: var(--accent-dark);
      color: #000;
      font-weight: 700;
      border: none;
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
    }
    button:hover { transform: translateY(-3px); background: #d9ff58; }

    .result {
      background: rgba(30,30,30,0.9);
      border: 1px solid rgba(255,255,255,0.03);
      padding: 10px 12px;
      border-radius: 8px;
      color: var(--accent);
      font-weight: 600;
    }

    .section {
      margin-bottom: 22px;
    }

    .divider {
      height:1px;
      background: rgba(255,255,255,0.03);
      margin: 20px 0;
    }

    /* efficiency bar */
    .efficiency-bar {
      width:100%;
      height: 22px;
      background: #0e0e0e;
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.03);
      margin-top:10px;
    }
    .efficiency-fill {
      height:100%;
      width:0%;
      background: var(--accent-dark);
      transition: width 700ms cubic-bezier(0.22,1,0.36,1);
    }

    /* Chart */
    #chartWrap { margin-top: 18px; background:#0b0b0b; padding:14px; border-radius:10px; border:1px solid rgba(255,255,255,0.03); }
    canvas { display:block; max-width:100%; }

    footer {
      text-align:center;
      margin-top:20px;
      color:#aaa;
      font-size:0.9rem;
    }

    @media (max-width:820px) {
      .grid { grid-template-columns: 1fr; }
      .container { padding:18px; }
    }
  </style>
</head>
<body>
  <div class="container" role="main" aria-label="Oakridge Utility Suite">
    <h1>Oakridge Utility Suite</h1>

    <!-- Demand -->
    <div class="section">
      <h2>Demand Calculator</h2>
      <div class="grid">
        <div>
          <label for="demandInput">Enter demand number</label>
          <input id="demandInput" type="number" placeholder="e.g. 1190" />
        </div>
        <div style="align-self:end;">
          <button id="calcDemandBtn">Calculate Demand</button>
        </div>

        <div class="full">
          <div id="demandResult" class="result" style="display:none;"></div>
        </div>
      </div>
    </div>

    <div class="divider" aria-hidden="true"></div>

    <!-- Paycheck -->
    <div class="section">
      <h2>Paycheck System</h2>
      <div class="grid">
        <div>
          <label for="hoursInput">Enter your hours (or value)</label>
          <input id="hoursInput" type="number" placeholder="e.g. 8" />
        </div>
        <div>
          <label for="rateInput">Enter your rate per hour</label>
          <input id="rateInput" type="number" placeholder="e.g. 10" />
        </div>

        <div class="full" style="display:flex; gap:12px; align-items:center;">
          <button id="calcPayBtn">Calculate Paycheck</button>
          <div id="payResult" class="result" style="display:none;"></div>
        </div>
      </div>
    </div>

    <div class="divider" aria-hidden="true"></div>

    <!-- Efficiency -->
    <div class="section">
      <h2>Reactor Efficiency Calculator</h2>
      <div class="grid">
        <div>
          <label for="P_input">Reactor Power (P)</label>
          <input id="P_input" type="number" placeholder="Total Reactor Power (P)" />
        </div>
        <div>
          <label for="C_input">Core Temperature (C)</label>
          <input id="C_input" type="number" placeholder="Core Temperature (C)" />
        </div>

        <div>
          <label for="O_input">Plant Output (O)</label>
          <input id="O_input" type="number" placeholder="Plant Output (O)" />
        </div>

        <div style="align-self:end;">
          <button id="updateEffBtn">Calculate Efficiency & Plot Graph</button>
        </div>

        <div class="full">
          <div id="effResult" class="result" style="display:none;"></div>
          <div class="efficiency-bar" aria-hidden="true">
            <div id="effFill" class="efficiency-fill"></div>
          </div>

          <div id="chartWrap">
            <canvas id="effChart" height="240" aria-label="Efficiency graph"></canvas>
          </div>
        </div>
      </div>
    </div>

    <footer>© 2025 | Made by 4_mighty_4 + sixhness</footer>
  </div>

  <script>
    /* -------------------------
       Mathematical helpers
       ------------------------- */

    // Reactor weighted power: Pw = 2P/3
    function Pw_from_P(P) {
      return (2 * P) / 3;
    }

    // Plant output weighted: Ow = 107*O / 100
    function Ow_from_O(O) {
      return (107 * O) / 100;
    }

    // Reactor power limiter PL as piecewise:
    // t = (Pw - 1600) / 500
    // PL = 1 if t > 1
    // PL = t if 0 <= t <= 1
    // PL = 0 if t < 0
    function PL_from_Pw(Pw) {
      const t = (Pw - 1600) / 500;
      if (t > 1) return 1;
      if (t >= 0) return t;
      return 0;
    }

    // Core efficiency formula for a given Ow and Pw and C:
    // E = PL * ( 65 * (Ow / (Pw - 1600)) + 35 * ( 77 * (Ow/4570 + 0.65) / C ) )
    // Note: caller must ensure Pw - 1600 != 0 and C != 0. We'll guard numerically.
    function E_from_Ow_Pw_C(Ow, Pw, C) {
      // guard Pw - 1600
      const denom = Pw - 1600;
      if (denom === 0 || C === 0) {
        return NaN; // invalid - handled by caller
      }
      const PL = PL_from_Pw(Pw);
      if (PL === 0) return 0;
      const term1 = 65 * (Ow / denom);
      const term2 = 35 * (77 * (Ow / 4570 + 0.65) / C);
      const E = PL * (term1 + term2);
      return E;
    }

    /* -------------------------
       DOM bindings
       ------------------------- */

    const el = id => document.getElementById(id);

    // Demand
    el('calcDemandBtn').addEventListener('click', () => {
      const raw = parseFloat(el('demandInput').value);
      const out = el('demandResult');
      if (Number.isNaN(raw)) {
        out.style.display = 'block';
        out.textContent = 'Please enter a valid demand number.';
        return;
      }
      const demand = raw / 2 + 12;
      out.style.display = 'block';
      out.textContent = `Demand Value = ${demand.toFixed(2)}`;
    });

    // Paycheck
    el('calcPayBtn').addEventListener('click', () => {
      const hours = parseFloat(el('hoursInput').value);
      const rate  = parseFloat(el('rateInput').value);
      const out = el('payResult');
      if (Number.isNaN(hours) || Number.isNaN(rate)) {
        out.style.display = 'block';
        out.textContent = 'Please enter valid hours and rate.';
        return;
      }
      out.style.display = 'block';
      out.textContent = `Total Paycheck = ${(hours * rate).toFixed(2)}`;
    });

    /* -------------------------
       Chart.js setup
       ------------------------- */
    const ctx = document.getElementById('effChart').getContext('2d');
    const effChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: [], // x values (plant output)
        datasets: [{
          label: 'Efficiency (%)',
          data: [],
          borderColor: 'rgba(168,255,0,0.95)',
          backgroundColor: 'rgba(168,255,0,0.09)',
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.28,
          fill: true,
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          x: {
            title: { display: true, text: 'Plant Output (x)' },
            ticks: { color: '#bbb' },
            grid: { color: 'rgba(255,255,255,0.03)' }
          },
          y: {
            title: { display: true, text: 'Efficiency (%)' },
            suggestedMin: 0,
            suggestedMax: 140,
            ticks: { color: '#bbb' },
            grid: { color: 'rgba(255,255,255,0.03)' }
          }
        },
        plugins: {
          legend: { labels: { color: '#ddd' } },
          tooltip: {
            callbacks: {
              label: ctx => ` ${ctx.parsed.y.toFixed(2)}%`
            }
          }
        }
      }
    });

    /* -------------------------
       Efficiency calculation + graph
       ------------------------- */

    // animate the efficiency-fill bar width and set color
    function setEffBar(percentage, color) {
      const fill = el('effFill');
      const clamped = Math.max(0, Math.min(100, percentage));
      fill.style.width = clamped + '%';
      fill.style.backgroundColor = color;
    }

    function updateEfficiencyAndGraph() {
      const P = parseFloat(el('P_input').value);
      const C = parseFloat(el('C_input').value);
      const O = parseFloat(el('O_input').value);

      const out = el('effResult');

      if (Number.isNaN(P) || Number.isNaN(C) || Number.isNaN(O)) {
        out.style.display = 'block';
        out.textContent = 'Please enter valid numbers for Reactor Power, Core Temp and Plant Output.';
        // reset chart and bar
        effChart.data.labels = [];
        effChart.data.datasets[0].data = [];
        effChart.update();
        setEffBar(0, '#555');
        return;
      }

      // compute Pw and Ow
      const Pw = Pw_from_P(P);
      const Ow = Ow_from_O(O);

      // guard for Pw - 1600 and C
      const denom = Pw - 1600;
      if (denom === 0 || C === 0) {
        out.style.display = 'block';
        out.textContent = 'Invalid values: check Reactor Power or Core Temp (would cause division by zero).';
        setEffBar(0, '#555');
        return;
      }

      // compute single efficiency for the given O (using Ow)
      const E = E_from_Ow_Pw_C(Ow, Pw, C);
      const displayE = (Number.isNaN(E) ? 0 : E);
      out.style.display = 'block';
      out.textContent = `Reactor Efficiency = ${displayE.toFixed(4)}%`;

      // color thresholds (based on actual E)
      let color = '#a8ff00'; // green
      if (displayE < 50) color = '#ff3b3b';
      else if (displayE < 80) color = '#ffb400';

      // set bar visually clamped between 0 and 100
      setEffBar(displayE, color);

      // Build graph: x from 0 to max( O, a little more ) with n points
      const maxX = Math.max( Math.max(100, O), Math.ceil(O * 1.05) );
      const points = 120; // smooth
      const labels = [];
      const data = [];

      for (let i = 0; i <= points; i++) {
        const x = (maxX) * (i / points);
        const Ow_g = Ow_from_O(x);      // O_wg = 107 * x / 100
        const Eg = ( (Pw - 1600) === 0 || C === 0 ) ? NaN : E_from_Ow_Pw_C(Ow_g, Pw, C);
        labels.push(x.toFixed(0));
        data.push( Number.isNaN(Eg) ? 0 : Eg );
      }

      // update chart y-range adaptively for better viewing
      const maxVal = Math.max(...data, displayE, 100);
      const suggestedMax = Math.ceil(Math.max(120, maxVal + 10));

      effChart.options.scales.y.suggestedMax = suggestedMax;
      effChart.data.labels = labels;
      effChart.data.datasets[0].data = data;
      effChart.update();
    }

    // wire the button
    el('updateEffBtn').addEventListener('click', updateEfficiencyAndGraph);

    // small convenience: press Enter in any efficiency input triggers update
    ['P_input','C_input','O_input'].forEach(id => {
      el(id).addEventListener('keydown', e => {
        if (e.key === 'Enter') updateEfficiencyAndGraph();
      });
    });

    // initial demo values (optional)
    el('P_input').value = 1800;
    el('C_input').value = 3200;
    el('O_input').value = 1050;
    // draw initial graph
    updateEfficiencyAndGraph();
  </script>
</body>
</html>

